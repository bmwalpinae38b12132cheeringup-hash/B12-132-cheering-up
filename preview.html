<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BMW Alpina E38 B12 #132 - Фото из канала</title>
  
  <!-- Open Graph метатеги -->
  <meta property="og:title" content="BMW Alpina E38 B12 #132">
  <meta property="og:description" content="Фото из канала @alpina_b12_132">
  <meta property="og:type" content="website">
  <meta property="og:url" content="" id="ogUrl">
  <meta property="og:image" content="" id="ogImage">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:site_name" content="BMW Alpina Gallery">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="BMW Alpina E38 B12 #132">
  <meta name="twitter:description" content="Фото из канала @alpina_b12_132">
  <meta name="twitter:image" content="" id="twitterImage">
  
  <!-- Редирект -->
  <meta http-equiv="refresh" content="0; url=./index.html">
</head>
<body>
  <script>
    // Получаем ID из URL
    const hash = window.location.hash;
    const id = hash ? hash.substring(1).split('?')[0] : '';
    
    if (id) {
      // Загружаем index.json чтобы получить правильное имя файла
      fetch('./data/index.json')
        .then(response => response.json())
        .then(data => {
          // Ищем запись с нужным ID
          const record = data.find(item => item.id == id || item.id.toString() === id);
          
          if (record && record.thumb) {
            // Формируем полный URL к превью
            const thumbUrl = 'https://pub-3a115c1e9a8b4541b7685443d9eb4263.r2.dev/' + record.thumb;
            const imageUrl = 'https://pub-3a115c1e9a8b4541b7685443d9eb4263.r2.dev/' + record.full;
            
            console.log('Found record:', record);
            console.log('Thumb URL:', thumbUrl);
            console.log('Image URL:', imageUrl);
            
            // Устанавливаем метатеги
            document.getElementById('ogImage').content = thumbUrl;
            document.getElementById('twitterImage').content = thumbUrl;
            document.getElementById('ogUrl').content = window.location.href;
            
            // Если есть описание - используем его
            if (record.caption) {
              document.querySelector('meta[property="og:description"]').content = record.caption;
              document.querySelector('meta[name="twitter:description"]').content = record.caption;
            }
            
            // Показываем отладочную информацию
            document.body.innerHTML = `
              <div style="padding: 20px; max-width: 800px; margin: 0 auto; font-family: Arial; text-align: center;">
                <h2>Превью для Telegram</h2>
                <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin: 20px 0;">
                  <p><strong>ID:</strong> ${record.id}</p>
                  <p><strong>Дата:</strong> ${new Date(record.date).toLocaleDateString()}</p>
                  <p><strong>Описание:</strong> ${record.caption || '(без описания)'}</p>
                  <p><strong>Файл:</strong> ${record.file}</p>
                  <img src="${thumbUrl}" alt="Превью" style="max-width: 400px; margin: 20px auto; border: 1px solid #ddd; display: block;">
                  <p><small>Это превью будет отображаться в Telegram при отправке ссылки</small></p>
                </div>
                <p>Автоматический переход в галерею через 5 секунд...</p>
                <p><a href="./index.html${hash}" style="color: #0088cc; text-decoration: none; font-weight: bold;">▶ Перейти к фото в галерее</a></p>
              </div>
            `;
            
          } else {
            // Запись не найдена
            document.body.innerHTML = `
              <div style="padding: 20px; text-align: center;">
                <h3>Фото не найдено</h3>
                <p>Запись с ID "${id}" не найдена в каталоге.</p>
                <p><a href="./index.html">Перейти в галерею</a></p>
              </div>
            `;
          }
          
          // Редирект через 5 секунд
          setTimeout(() => {
            window.location.replace('./index.html' + hash);
          }, 5000);
        })
        .catch(error => {
          console.error('Error loading index.json:', error);
          document.body.innerHTML = `
            <div style="padding: 20px; text-align: center;">
              <h3>Ошибка загрузки</h3>
              <p>Не удалось загрузить данные галереи.</p>
              <p><a href="./index.html">Перейти в галерею</a></p>
            </div>
          `;
        });
        
    } else {
      // Нет ID - сразу редирект
      window.location.replace('./index.html');
    }
  </script>
  
  <noscript>
    <div style="padding: 20px; text-align: center;">
      <p>Для работы превью требуется JavaScript.</p>
      <p><a href="./index.html">Перейти в галерею</a></p>
    </div>
  </noscript>
</body>
</html>
